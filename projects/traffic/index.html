<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calculator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="../../style.css">

  <style>
    .card-group-bg {
      /* background-color: #edf5f7; */
      width: 100%;
      padding: 20px;
    }
  </style>

  <style>
    body {
      /* overflow: hidden; */
    }

    #main {
      /* height: calc(100vh - 56px); */
      margin-top: 80px;
      margin-bottom: 500px;
    }

    #main .contents {
      height: 100%;
    }

    #main #preview-iframe {
      height: 100%;
      border: none;
    }

    .editor {
      width: 100%;
      height: 400px;
      resize: none;
      border: none;
    }

    iframe {
      width: 100%;
      height: 100%;
    }

    .editors {}

    .preview {
      background-color: #ffffff;
      height: 100%;
      position: fixed;
      right: 0px;
    }

    #preview {
      height: 100%;
    }

    .btn.action {
      width: 100px;
    }

    #main #solution-code {
      display: none;
    }

    #main.show #solution-code {
      display: block;
    }
  </style>
</head>

<body>
  <!-- <nav class="navbar navbar-expand bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Learn to Decode</a>
    </div>
  </nav> -->
  <nav class="navbar navbar-expand-sm  navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="#">Learn to Decode</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link  disabled" aria-disabled="true" href="/about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled" aria-disabled="true" href="/contact.html">Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" onclick="passcode()">Resources</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/projects/#traffic">Projects</a>
        </li>
      </ul>
    </div>
  </nav>

  <div id="main" class="fluid-container edit-and-preview">

    <div class="row contents">
      <div class="col-6 editors">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <h3 class="mt-4">Traffic Simulator: Smart Signal Control Tutorial</h3>

              <p class="lead">
                This interactive tutorial teaches students how to create intelligent traffic light control systems using JavaScript.
                By harnessing real-time data from a traffic simulation, students learn to write algorithms that optimize traffic flow at an intersection.
              </p>
                    
              <h4>What You'll Learn</h4>
              <ul>
                <li>How to listen for custom events in JavaScript</li>
                <li>How to access and interpret real-time traffic statistics</li>
                <li>How to use conditional logic to make automated decisions</li>
                <li>How to optimize traffic signals based on multiple factors</li>
              </ul>
                    
              <h4>Key Concepts</h4>
              <p>
                The tutorial introduces the <code>trafficStatsChange</code> event that provides live data about traffic conditions, including:
              </p>
              <ul>
                <li>Wait times for vehicles</li>
                <li>Number of stopped cars</li>
                <li>Traffic throughput and efficiency metrics</li>
                <li>Time since traffic signals last changed</li>
              </ul>
                    
              <p>
                Students implement progressively more sophisticated control algorithms:
              </p>
              <ol>
                <li>Simple timed signal changes</li>
                <li>Traffic volume-based control</li>
                <li>Wait time optimization</li>
                <li>Multi-factor "pressure score" systems</li>
              </ol>
                    
              <h4>Interactive Environment</h4>
              <p>
                The split-screen layout provides:
              </p>
              <ul>
                <li>A code editor where students write JavaScript to control traffic signals</li>
                <li>A live traffic simulation showing the effects of their algorithms</li>
                <li>Real-time statistics to evaluate their solution's effectiveness</li>
              </ul>
                    
              <p class="alert alert-info">
                This project offers a practical application of programming concepts in a relatable real-world scenario that 
                students can visualize and optimize through experimentation.
              </p>

              <h4>Using the trafficStatsChange Event</h4>
          
              <p>The traffic simulator provides real-time statistics through a custom event called <code>trafficStatsChange</code>. 
                 You can use this event to create smart traffic light controllers that respond to changing traffic conditions!</p>
              
              <h5>Step 1: Create an Event Listener</h5>
              <p>First, you need to set up a listener that will run your code whenever new traffic data becomes available. 
                 The event listener connects to the simulation container and gives you access to real-time traffic statistics.</p>
              <pre class="bg-light p-3"><code>document.getElementById('simulation-container').addEventListener('trafficStatsChange', function(event) {
  // Your traffic control logic goes here
  const stats = event.detail;
  
  // Example: Log the current stats to see what's happening
  console.log(stats);
});</code></pre>
              
              <h5>Step 2: Access Traffic Statistics</h5>
              <p>The <code>event.detail</code> object contains all the data you need about the current traffic situation. Each field provides specific information that you can use to make intelligent decisions about when to change the traffic lights.</p>
                            
              <table class="table table-bordered">
                <thead class="thead-light">
                  <tr>
                    <th>Field Name</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td><code>'Time since last signal change'</code></td><td>Seconds since traffic lights changed - use this to prevent lights from changing too frequently</td></tr>
                  <tr><td><code>'Time since first car stopped'</code></td><td>Seconds since the first car stopped - helps identify long waits at red lights</td></tr>
                  <tr><td><code>'Number of cars stopped'</code></td><td>Current count of stopped cars - indicates congestion at red lights</td></tr>
                  <tr><td><code>'Total cars passed'</code></td><td>Total cars that passed through - measures overall throughput of your system</td></tr>
                  <tr><td><code>'Total cars approached'</code></td><td>Total cars that approached - shows total traffic volume handled</td></tr>
                  <tr><td><code>'Avg cars per minute'</code></td><td>Average throughput rate - indicates efficiency of your signal timing</td></tr>
                  <tr><td><code>'Avg approaches per minute'</code></td><td>Average approach rate - shows traffic demand over time</td></tr>
                  <tr><td><code>'Avg wait time (sec)'</code></td><td>Average wait time per car - key measure of driver experience</td></tr>
                </tbody>
              </table>
              
              <h5>Step 3: Create Logic to Control Signals</h5>
              <p>Now comes the fun part! You can write conditional statements (if statements) that decide when to change the traffic lights based on the statistics you're receiving. The goal is to create a system that keeps traffic flowing efficiently.</p>
                            
              <div class="alert alert-info">
                <strong>Tip:</strong> Use <code>document.getElementById('toggleLights').click()</code> to change traffic lights. This simulates clicking the button that controls the signals.
              </div>
              
              <h6>Example: Change Lights After Set Time</h6>
              <p>This simple approach changes lights on a fixed schedule, similar to traditional traffic lights:</p>
              <pre class="bg-light p-3"><code>// Change lights every 30 seconds
if (stats['Time since last signal change'] >= 30) {
  document.getElementById('toggleLights').click();
}</code></pre>
              
              <h6>Example: Change Based on Traffic Volume</h6>
              <p>This smarter approach responds to the number of cars waiting at red lights, but still ensures a minimum green time:</p>
              <pre class="bg-light p-3"><code>// Change lights when more than 5 cars are waiting
if (stats['Number of cars stopped'] > 5 && stats['Time since last signal change'] >= 15) {
  document.getElementById('toggleLights').click();
}</code></pre>
              
              <h6>Example: Change Based on Wait Time</h6>
              <p>This approach focuses on driver experience by monitoring the average wait time:</p>
              <pre class="bg-light p-3"><code>// Change when average wait time is too high
if (stats['Avg wait time (sec)'] > 20 && stats['Time since last signal change'] >= 10) {
  document.getElementById('toggleLights').click();
}</code></pre>
              
              <h5>Challenge: Smart Traffic Control</h5>
              <p>Create a traffic control algorithm that balances wait times and throughput by considering multiple factors at once. 
                 This more advanced approach uses a scoring system to weigh different aspects of the traffic situation:</p>
              <pre class="bg-light p-3"><code>// Calculate a "pressure score" based on multiple factors
const waitScore = stats['Number of cars stopped'] * 2;   // More weight for stopped cars
const timeScore = stats['Avg wait time (sec)'] * 1.5;    // Some weight for waiting time
const totalScore = waitScore + timeScore;

// Change lights if pressure exceeds threshold and minimum time has passed
if (totalScore > 25 && stats['Time since last signal change'] >= 10) {
  console.log(`Changing lights: Score=${totalScore.toFixed(1)}`);
  document.getElementById('toggleLights').click();
}</code></pre>

<h6>Using If/Else Statements for More Advanced Control</h6>
<p>Sometimes you need to make different decisions based on various conditions. This is where if/else statements become powerful:</p>

<pre class="bg-light p-3"><code>// Basic if/else structure
if (condition) {
  // Code that runs when condition is true
} else {
  // Code that runs when condition is false
}

// Example: Different behavior based on traffic direction
if (stats['Number of cars stopped'] > 8) {
  // Heavy congestion - change lights immediately
  document.getElementById('toggleLights').click();
} else {
  // Lower congestion - log status but don't change yet
  console.log("Traffic still flowing well, maintaining current signal");
}</code></pre>

<h6>Multiple Conditions with Else If</h6>
<p>For more complex decision trees with multiple options, use else if:</p>

<pre class="bg-light p-3"><code>// Different actions based on congestion level
if (stats['Number of cars stopped'] > 10) {
  // Heavy congestion - immediate action
  console.log("Heavy congestion detected!");
  document.getElementById('toggleLights').click();
} else if (stats['Number of cars stopped'] > 5) {
  // Medium congestion - check wait time before deciding
  if (stats['Avg wait time (sec)'] > 15) {
    console.log("Medium congestion with significant wait times");
    document.getElementById('toggleLights').click();
  }
} else {
  // Light traffic - maintain regular timing
  if (stats['Time since last signal change'] >= 30) {
    console.log("Regular signal change on timer");
    document.getElementById('toggleLights').click();
  }
}</code></pre>

<h6>Nested If Statements</h6>
<p>You can place if statements inside other if statements to create more complex logic:</p>

<pre class="bg-light p-3"><code>// Nested decision example
if (stats['Time since last signal change'] >= 10) {
  // Minimum time has passed, now we can consider changing
  if (stats['Number of cars stopped'] > 3) {
    // Check if cars have been waiting too long
    if (stats['Time since first car stopped'] > 20) {
      console.log("Cars waiting too long - changing lights");
      document.getElementById('toggleLights').click();
    }
  }
}</code></pre>

<div class="alert alert-warning">
  <strong>Tip:</strong> While nested if statements are powerful, don't make them too complex! 
  Too much nesting can make your code hard to understand and maintain.
</div>
              <p>Try modifying these examples to create your own traffic control system! What factors do you think are most important? Can you create an algorithm that outperforms standard timed lights?</p>

              <h3>Traffic Signal Logic Editor</h3>
              <div id="script" class="editor mb-3"></div>
              <button class="btn action btn-primary form-control" id="run">Run</button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6 preview">
        <div id="preview" class="col-12 g-0 mt-4">
          <iframe id="preview-iframe"></iframe>
        </div>
      </div>
    </div>

  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.27.0/min/vs/loader.js"></script>
  <script>
    let updatePreview;
    let contenteditable = "";

    let run = (values) => {
      require.config({
        paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.27.0/min/vs",
                 espree: "https://cdn.jsdelivr.net/npm/espree@10.3.0/espree.js",
                 esprima: "https://unpkg.com/esprima@~4.0/dist/esprima.js"
         }
      });
      require(["vs/editor/editor.main"], function () {

        monaco.editor.defineTheme('default', {
          base: 'vs-dark',
          inherit: true,
          rules: [
            {
              token: "identifier",
              foreground: "9CDCFE"
            },
            {
              token: "identifier.function",
              foreground: "DCDCAA"
            },
            {
              token: "type",
              foreground: "1AAFB0"
            }
          ],
          colors: {}
        });
        monaco.editor.setTheme('default')

        var scriptEditor = monaco.editor.create(document.getElementById("script"), {
          value: values.script,
          language: "html",
          automaticLayout: true
        });

        document.getElementById("main").editors = {
          script: scriptEditor
        }

        const src = `<!DOCTYPE=html>
<html lang="en">
  <head>
    <title>Learn to Decode</title>
    <style>
      \${style}
    </style>
  </head>
  <body \${contenteditable}>
    <div id="content">
      \${body}
    </div>
    \${script}
  </body>
</html>`;
        updatePreview = function (event) {
          let template = src;
          template = template.replace("${contenteditable}", contenteditable);
          template = template.replace("${body}", values.html);
          let inputs = document.querySelectorAll("#copyright-form input");
          for (var i = 0; i < inputs.length; i++) {
            let input = inputs[i];
            if (input.value.trim() === "") {
              continue;
            }
            let slug = input.getAttribute("data-slug");
            template = template.replace(slug, input.value);
          }
          template = template.replace("${style}", values.style);
          let pageInputs = document.querySelectorAll("#page-form input");
          for (let i = 0; i < pageInputs.length; i++) {
            let input = pageInputs[i];
            if (input.value.trim() === "") {
              continue;
            }
            let slug = input.getAttribute("data-slug");
            template = template.replace(slug, input.value);
          }

          template = template.replace("${script}", scriptEditor.getValue());

          document.getElementById("preview-iframe").srcdoc = template;
        }

        const page = values.page;
        const keys = Object.keys(page);
        for (let i = 0; i < keys.length; i++) {
          let key = keys[i];
          let item = page[key];
          if (typeof item === 'string') {
            continue;
          }
          let fields = Object.keys(item);
          for (let j = 0; j < fields.length; j++) {
            let field = fields[j];
            let value = item[field];
            let selector = `#${key}-form #${field}`;
            document.querySelector(selector).value = value;
          }
        }

        document.getElementById("run").addEventListener("click", (ev) => {
          updatePreview();
        });

        updatePreview();
      });
    };
  </script>

  <script>
    (async function () {

      const getContent = async function (path) {
        const folder = window.location.hash.slice(1);
        const response = await fetch(path);
        const content = await response.text();
        return content;
      }

      const json = await getContent("page.json");
      const page = JSON.parse(json);

      document.title = page.title;

      const html = await getContent("content.txt");
      const style = await getContent("style.css");
      const script = await getContent("script.html");

      const doc = {
        page: page,
        html: html,
        css: style,
        script: script
      }
      run(doc);
    })();
  </script>


</body>

</html>