<div class="meta-data title">Download</div>
<div class="container content-container mt-4" style="margin-bottom: 200px;">
  <div class="row">
    <div class="col-md-12">
      <div class="container g-0 mb-3">
        <p>Please register to access your download.</p>
        <form id="registration-form" class="row g-3">
          <div class="col-auto">
            <input type="text" class="form-control" id="name" name="name" placeholder="Your name" required />
          </div>
          <div class="col-auto">
            <input type="text" class="form-control" id="email" name="email" placeholder="Your email" required />
          </div>
          <div class="col-auto">
            <button type="button" class="btn btn-primary g-recaptcha"
              data-sitekey="6LfNbFkpAAAAACRDw-PNuGINY7sgAFJAhOM5CWmg" data-callback="onSubmit" data-action="submit">
              Register
            </button>
          </div>
          <input type="hidden" id="id" name="id" />
          <input type="hidden" id="unique" name="unique" value="email" />
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  async function onSubmit(token) {
    if (!document.getElementById("name").value) {
      alert("Please enter your name.");
      return;
    }

    if (!document.getElementById("email").value) {
      alert("Please enter your email address.");
      return;
    }

    $('.modal').modal('show');

    document.getElementById("id").value =
      document.getElementById("email").value;

    const data = Object.fromEntries(
      new FormData(document.getElementById("registration-form")).entries()
    );

    const response = await fetch(
      "https://api.everybodyelses.com/v1/subscribe/learntodecode/emails",
      {
        method: "POST",
        mode: "cors",
        cache: "no-cache",
        credentials: "same-origin",
        headers: {
          "Content-Type": "application/json",
        },
        redirect: "follow",
        referrerPolicy: "no-referrer",
        body: JSON.stringify(data),
      }
    );

    $('.modal').modal('hide');

    if (response.status === 200) {
      alert(
        "Thank you for registering. Please check your email to retrieve your download link."
      );
    } else {
      const body = await response.json();
      alert("Something went wrong: " + body);
    }
  }
</script>

<div class="modal bd-modal-lg" data-keyboard="false" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </div>
</div>